{# templates/products/product_detail.html #}
{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="row">
  <div class="col-md-6">
    {% with imgs=object.images.all %}
    <div class="product-gallery position-relative"
         data-images='[
           {% for img in imgs %}
             "{{ img.image.url }}"{% if not forloop.last %}, {% endif %}
           {% endfor %}
         ]'
         style="overflow:hidden;"
    >
      {% if imgs %}
        <img src="{{ imgs.0.image.url }}"
             class="product-main-image img-fluid"
             alt="{{ object.title }}">
      {% else %}
        <img src="{% static 'img/placeholder.png' %}"
             class="product-main-image img-fluid"
             alt="Нет изображения">
      {% endif %}
    </div>
    {% endwith %}
  </div>

  <div class="col-md-6">
    <h1>{{ object.title }}</h1>
    <p>{{ object.description }}</p>
    {# … вариант выбрать, добавить в корзину и т.д. … #}
  </div>
</div>
{% endblock content %}

{% block extra_scripts %}
<script>
document.addEventListener('DOMContentLoaded', () => {
  document.querySelectorAll('.product-gallery').forEach(wrapper => {
    const imgEl = wrapper.querySelector('img.product-main-image');
    let images;
    try {
      images = JSON.parse(wrapper.dataset.images);
    } catch {
      return;
    }
    const n = images.length;
    if (n <= 1) return;

    wrapper.addEventListener('mousemove', e => {
      const { left, width } = wrapper.getBoundingClientRect();
      let x = e.clientX - left;
      x = Math.max(0, Math.min(x, width));
      const idx = Math.floor(x / width * n);
      imgEl.src = images[idx];
    });

    wrapper.addEventListener('mouseleave', () => {
      imgEl.src = images[0];
    });
  });
});
</script>
{% endblock extra_scripts %}
